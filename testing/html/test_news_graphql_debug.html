<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Debug Test - News/Updates</title>
</head>
<body>
    <h1>GraphQL Debug Test - News/Updates</h1>
    <div id="output"></div>

    <script>
        async function testGraphQL() {
            const output = document.getElementById('output');

            // Test with exact query structure from GET_ALL_UPDATES
            const query = `
                query GetAllUpdates {
                    allUpdates {
                        id
                        type
                        title
                        summary
                        body
                        timestamp
                        status
                        tags
                        author
                        icon
                        priority
                        isActive
                        createdAt
                        updatedAt
                        expiresAt
                        createdBy {
                            id
                            username
                            firstName
                            lastName
                        }
                    }
                }
            `;

            try {
                console.log('Sending query:', query);

                const response = await fetch('http://localhost:8000/graphql/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluIiwiZXhwIjoxNzU3MDg4Mzk2LCJpYXQiOjE3NTcwMDE5OTZ9.A3Bx0CdO8WjJUnWwhC_o5S26jyfkxt1A6xh227JH8mU'
                    },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                console.log('Response:', result);

                if (response.status === 400) {
                    output.innerHTML = `
                        <h2 style="color: red;">❌ GraphQL Error (Status: ${response.status})</h2>
                        <h3>Error Details:</h3>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px;">${JSON.stringify(result, null, 2)}</pre>
                        <h3>Query Sent:</h3>
                        <pre style="background: #f0f8ff; padding: 10px; border-radius: 5px;">${query}</pre>
                    `;
                } else if (response.ok) {
                    output.innerHTML = `
                        <h2 style="color: green;">✅ GraphQL Success (Status: ${response.status})</h2>
                        <h3>Data (${result.data?.allUpdates?.length || 0} items):</h3>
                        <pre style="background: #f0f8f0; padding: 10px; border-radius: 5px;">${JSON.stringify(result, null, 2)}</pre>
                    `;
                } else {
                    output.innerHTML = `
                        <h2 style="color: orange;">⚠️ Unexpected Status: ${response.status}</h2>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                console.error('Request failed:', error);
                output.innerHTML = `
                    <h2 style="color: red;">❌ Request Failed</h2>
                    <pre>${error.message}</pre>
                `;
            }
        }

        // Run test on page load
        testGraphQL();
    </script>
</body>
</html>
